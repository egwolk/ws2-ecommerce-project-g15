<div class="products-admin">
<h1>Admin – Sales Overview</h1>
<p class="no-print">
    <a href="/admin/products">Back to Products</a> |
    <a href="/admin/orders">View Orders</a>
</p>
<section style="margin-bottom: 15px;" class="no-print">
    <h2>Report Actions</h2>
    <div style="display:flex;">
        <p>
            <!-- Daily sales XLSX export -->
            <a
                href="/admin/reports/sales/export/daily?startDate=<%= filters.startDate
                %>&endDate=<%= filters.endDate %>&status=<%= filters.status %>"
                class="btn-secondary"
            >
                Download Daily Sales (XLSX)
            </a>
        </p>
        <p>
            <!-- Detailed orders XLSX export (you will implement later) -->
            <a
                href="/admin/reports/sales/export/orders?startDate=<%= filters.startDate
                %>&endDate=<%= filters.endDate %>&status=<%= filters.status %>"
                class="btn-secondary"
            >
                Download Detailed Orders (Excel)
            </a>
        </p>
        <p>
            <!-- Print / Save as PDF (handled via external script to satisfy CSP) -->
            <button type="button" id="printReportBtn" class="btn-secondary">
                Print / Save as PDF
            </button>
        </p>
    </div>
</section>

<section class="no-print">
    <h2>Filters</h2>
    <form action="/admin/reports/sales" method="GET" style="display: flex;">
        <p>
            <label for="startDate">Start date:</label><br />
            <input
                type="date"
                id="startDate"
                name="startDate"
                value="<%= filters.startDate %>"
            />
        </p>
        <p>
            <label for="endDate">End date:</label><br />
            <input
                type="date"
                id="endDate"
                name="endDate"
                value="<%= filters.endDate %>"
            />
        </p>
        <p>
            <label for="status">Order status:</label><br />
            <select id="status" name="status">
                <option value="all" <%= filters.status === 'all' ? 'selected' : '' %>>
                    All statuses
                </option>
                <option value="to_pay" <%= filters.status === 'to_pay' ? 'selected' : ''
                %>>
                    To Pay
                </option>
                <option value="completed" <%= filters.status === 'completed' ? 'selected'
                : '' %>>
                    Completed
                </option>
            </select>
        </p>
        <p>
            <button type="submit" class="btn-secondary ">Apply filters</button>
            <a href="/admin/reports/sales" class="clear btn-secondary">Clear</a>
        </p>
    </form>
</section>
<section>
<h2>Current Filter Summary</h2>
    <% if (!filters.startDate && !filters.endDate && filters.status === 'all') { %>
        <p>Showing all orders for all dates and all statuses.</p>
    <% } else { %>
        <p>
            Showing orders
            <% if (filters.status === 'all') { %>
                with all statuses
            <% } else { %>
                with status "<%= filters.status %>"
            <% } %>
            <% if (filters.startDate && filters.endDate) { %>
                from <%= filters.startDate %> to <%= filters.endDate %>.
            <% } else if (filters.startDate && !filters.endDate) { %>
                from <%= filters.startDate %> onwards.
            <% } else if (!filters.startDate && filters.endDate) { %>
                up to <%= filters.endDate %>.
            <% } else { %>
                for all dates.
            <% } %>
        </p>
    <% } %>
</section>

<section>
    <h2>Summary</h2>
    <% if (dailySales.length === 0) { %>
        <p>No sales data found for the selected filters.</p>
    <% } else { %>
        <p><strong>Total Sales:</strong> ₱<%= summary.totalSales.toFixed(2) %></p>
        <p><strong>Total Orders:</strong> <%= summary.totalOrders %></p>
        <p><strong>Average Order Value:</strong> ₱<%=
        summary.averageOrderValue.toFixed(2) %></p>
    <% } %>
</section>
<section>
    <h2>Daily Sales Table</h2>
    <% if (dailySales.length === 0) { %>
        <p>No daily sales to display.</p>
    <% } else { %>

        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Total Sales</th>
                    <th>Number of Orders</th>
                </tr>
            </thead>
            <tbody>
                <% dailySales.forEach(function(day) { %>
                    <tr>
                        <td><%= day.date %></td>
                        <td>₱<%= Number(day.totalSales).toFixed(2) %></td>
                        <td><%= day.orderCount %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</section>
<section>
    <h2>Sales Chart</h2>
    <% if (dailySales.length === 0) { %>
        <p>No sales data to chart for the selected filters.</p>
    <% } else { %>
        <% const labelsJson = JSON.stringify(labels || []); %>
        <% const valuesJson = JSON.stringify(salesData || []); %>
        <simple-bar-chart
            title="Daily Sales"
            labels='<%- labelsJson %>'
            data='<%- valuesJson %>'
            width="600"
            height="300"
            color="#1e88e5"
        ></simple-bar-chart>
    <% } %>
</section>
<script src="/scripts/print.js?v=1"></script>
</div>