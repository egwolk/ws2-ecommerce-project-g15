<div class="products-container">
    <h1>Our Products</h1>
    
    <div style="margin-bottom: 30px;">
        <form action="/products" method="GET" style="max-width: 600px; margin: 0 auto;">
            <div style="display: flex; gap: 10px;">
                <input 
                    type="text" 
                    name="search" 
                    placeholder="Search products by name or category..." 
                    value="<%= typeof search !== 'undefined' ? search : '' %>"
                    style="flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;"
                >
                <button type="submit" class="btn-secondary" style="padding: 10px 25px; white-space: nowrap;">Search</button>
                <% if (typeof search !== 'undefined' && search) { %>
                    <a href="/products" class="btn-secondary" style="padding: 10px 25px; text-decoration: none; display: inline-block;">Clear</a>
                <% } %>
            </div>
            <% if (typeof ownedProductIds !== 'undefined' && ownedProductIds.length > 0) { %>
                <div style="margin-top: 15px; text-align: center;">
                    <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input 
                            type="checkbox" 
                            name="owned" 
                            value="true" 
                            <%= typeof showOwnedOnly !== 'undefined' && showOwnedOnly ? 'checked' : '' %>
                            onchange="this.form.submit()"
                            style="width: 18px; height: 18px; cursor: pointer;"
                        >
                        <span style="font-size: 14px; color:white;">Show only products I own</span>
                    </label>
                </div>
            <% } %>
        </form>
    </div>
    
    <% if (products.length === 0) { %>
        <% if (typeof search !== 'undefined' && search) { %>
            <p>No products found matching "<%= search %>". <a href="/products">View all products</a></p>
        <% } else { %>
            <p>No products available at the moment.</p>
        <% } %>
    <% } else { %>
        <% if (typeof search !== 'undefined' && search) { %>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">Found <%= products.length %> product<%= products.length !== 1 ? 's' : '' %> matching "<%= search %>"</p>
        <% } %>
        <div class="products-grid">
            <% products.forEach(product => { %>
                <a href="/products/<%= product._id %>" class="product-card">
                    <div class="img-container">
                        <% if (product.imageUrl) { %>
                            <img src="<%= product.imageUrl %>" alt="<%= product.name %>" loading="lazy">
                        <% } else { %>
                            <div class="no-image-placeholder">No Image</div>
                        <% } %>
                        <% if (typeof ownedProductIds !== 'undefined' && ownedProductIds.includes(product.productId)) { %>
                            <div style="position: absolute; top: 10px; right: 10px; background-color: #28a745; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                                OWNED
                            </div>
                        <% } %>
                    </div>
                    <div class="product-text">
                        <h3 class="product-title"><%= product.name %></h3>
                        <p class="product-description"><%= product.description.length > 50 ? product.description.substring(0, 50) + '...' : product.description %></p>
                        <div class="product-pricing">
                            <span class="product-price">â‚±<%= parseFloat(product.price || 0).toFixed(2) %></span>
                            <span class="product-category"><%= product.category %></span>
                        </div>
                    </div>
                </a>
            <% }) %>
        </div>
    <% } %>
</div>